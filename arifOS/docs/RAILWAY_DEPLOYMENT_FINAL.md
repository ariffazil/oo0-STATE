# Railway Deployment Guide - arifOS v52.5.1

**Complete guide for deploying arifOS Constitutional AI System to Railway**

**Status:** PRODUCTION READY  
**Version:** v52.5.1-SEAL  
**Authority:** Muhammad Arif bin Fazil

---

## Table of Contents

1. [Prerequisites](#prerequisites)
2. [Quick Start](#quick-start)
3. [Deployment Methods](#deployment-methods)
4. [Environment Variables](#environment-variables)
5. [Post-Deployment Validation](#post-deployment-validation)
6. [Troubleshooting](#troubleshooting)
7. [Advanced Configuration](#advanced-configuration)

---

## Prerequisites

### Required

- **Railway Account**: Sign up at [railway.app](https://railway.app)
- **GitHub Account**: For repository integration
- **Redis Service**: Required for AGI||ASI parallel execution

### Optional

- **Railway CLI**: For command-line deployment
- **k6**: For load testing (install from [k6.io](https://k6.io))

### Install Railway CLI

```bash
# macOS/Linux
curl -fsSL https://railway.app/install.sh | sh

# Windows (PowerShell)
iwr https://railway.app/install.ps1 | iex

# Verify installation
railway --version
```

---

## Quick Start

### Method 1: GitHub Integration (Recommended)

1. **Fork/Clone Repository**
   ```bash
   git clone https://github.com/ariffazil/arifOS.git
   cd arifOS
   ```

2. **Log into Railway**
   - Visit [railway.app](https://railway.app)
   - Click "Start a New Project"
   - Select "Deploy from GitHub repo"
   - Choose `arifOS` repository

3. **Add Redis Service**
   - In your Railway project dashboard
   - Click "+ New" → "Database" → "Add Redis"
   - Redis automatically creates `REDIS_URL` environment variable

4. **Configure Environment Variables**
   - Go to project → Variables tab
   - Add variables from [Environment Variables](#environment-variables) section
   - Railway automatically sets `REDIS_URL` from Redis service

5. **Deploy**
   - Railway automatically builds and deploys on push to `main`
   - Monitor logs in Railway dashboard

### Method 2: Railway CLI

```bash
# 1. Login to Railway
railway login

# 2. Initialize project (in arifOS directory)
railway init

# 3. Link to existing project (optional)
railway link

# 4. Add Redis
railway add --database redis

# 5. Set environment variables
railway variables set ARIFOS_CONSTITUTIONAL_MODE=AAA
railway variables set ARIFOS_HUMAN_SOVEREIGN=YourName

# 6. Deploy
railway up

# 7. Get deployment URL
railway domain
```

---

## Deployment Methods

### Automatic Deployment (GitHub)

Railway automatically deploys when you push to the `main` branch.

**Build Process:**
1. Railway detects `railway.toml` and uses Nixpacks builder
2. Installs dependencies from `requirements.txt`
3. Runs health check on `/health` endpoint
4. Exposes service on port 8000

**Configuration File:** `railway.toml`

```toml
[build]
builder = "nixpacks"

[deploy]
startCommand = "python -m arifos.mcp sse"
healthcheckPath = "/health"
healthcheckTimeout = 120
restartPolicyType = "ON_FAILURE"
numReplicas = 1
```

### Manual Deployment (CLI)

```bash
# Deploy current directory
railway up

# Deploy specific branch
railway up --branch staging

# Watch logs
railway logs
```

---

## Environment Variables

### Required Variables

| Variable | Value | Description |
|----------|-------|-------------|
| `PORT` | `8000` | Server port (auto-set by Railway) |
| `ARIFOS_CONSTITUTIONAL_MODE` | `AAA` | Constitutional governance mode |
| `ARIFOS_HUMAN_SOVEREIGN` | `YourName` | Human authority identifier |

### Automatically Set by Railway

| Variable | Source | Description |
|----------|--------|-------------|
| `REDIS_URL` | Redis service | Redis connection string |
| `RAILWAY_ENVIRONMENT` | Railway | `production` or `staging` |
| `RAILWAY_PUBLIC_DOMAIN` | Railway | Your deployment URL |

### Optional Variables

| Variable | Default | Description |
|----------|---------|-------------|
| `ARIFOS_LOG_LEVEL` | `INFO` | Logging level (`DEBUG`, `INFO`, `WARNING`, `ERROR`) |
| `ARIFOS_API_TOKEN` | None | API authentication token (recommended for production) |
| `OPENAI_API_KEY` | None | OpenAI API key (if using AI features) |
| `ANTHROPIC_API_KEY` | None | Anthropic API key (if using Claude) |
| `ARIFOS_VERSION` | `v52.5.1` | Version identifier |

### Security Variables (Production)

```bash
# Generate secure API token
railway variables set ARIFOS_API_TOKEN=$(python -c "import secrets; print(secrets.token_urlsafe(32))")

# Set genesis hash (generated by init_cooling_ledger.py)
railway variables set ARIFOS_GENESIS_HASH=<hash_value>
```

### Setting Variables via CLI

```bash
# Set single variable
railway variables set KEY=VALUE

# Set multiple variables from file
railway variables set --from-file .railway-env

# List all variables
railway variables

# Delete variable
railway variables delete KEY
```

---

## Post-Deployment Validation

### 1. Run Pre-Commission Script (Local)

Before deploying, validate configuration locally:

```bash
# Make script executable
chmod +x deploy/railway/pre_commission.sh

# Run pre-commissioning checks
./deploy/railway/pre_commission.sh
```

**Expected Output:**
```
==========================================
arifOS v52.5.1 Railway Pre-Commissioning
Phases 0A-0G Automation
==========================================
[0A] Validating configuration files...
✅ Phase 0A: Configuration files present
...
✅ Pre-Commissioning Complete
Ready for: railway up
==========================================
```

### 2. Health Check

Once deployed, verify the service is running:

```bash
# Get your Railway URL
export RAILWAY_URL=$(railway variables get RAILWAY_PUBLIC_DOMAIN)

# Check health
curl https://$RAILWAY_URL/health
```

**Expected Response:**
```json
{
  "status": "healthy",
  "version": "v52.5.1-SEAL",
  "tools": 5,
  "tool_names": ["000_init", "agi_genius", "asi_act", "apex_judge", "999_vault"],
  "uptime": "0:05:23"
}
```

### 3. Test Checkpoint Endpoint

```bash
curl -X POST https://$RAILWAY_URL/checkpoint \
  -H "Content-Type: application/json" \
  -d '{
    "query": "Is this action safe?",
    "context": "Testing deployment",
    "stakeholders": ["user"]
  }'
```

**Expected Response:**
```json
{
  "verdict": "SEAL",
  "summary": "Action validated through constitutional checkpoint",
  "session_id": "abc123...",
  "floors": {
    "F1": "PASS",
    "F2": "PASS",
    ...
  }
}
```

### 4. Run Validation Script

```bash
# Set Railway URL
export RAILWAY_URL=https://your-app.railway.app
export REDIS_URL=<your_redis_url>

# Run validation
python deploy/railway/validate_deployment.py
```

### 5. Load Testing (Optional)

If you have k6 installed:

```bash
# Install k6 (macOS)
brew install k6

# Run load test
export RAILWAY_URL=https://your-app.railway.app
k6 run tests/k6/checkpoint_load_test.js
```

**Target Metrics:**
- p95 latency: < 50ms
- Error rate: < 10%
- Throughput: 10+ requests/second

---

## Troubleshooting

### Common Issues

#### 1. Health Check Failing

**Symptom:** Railway shows "Unhealthy" status

**Solutions:**
```bash
# Check logs
railway logs

# Verify health endpoint locally
curl http://localhost:8000/health

# Increase health check timeout in railway.toml
healthcheckTimeout = 180
```

#### 2. Redis Connection Error

**Symptom:** `redis.exceptions.ConnectionError`

**Solutions:**
```bash
# Verify Redis service is running
railway status

# Check REDIS_URL is set
railway variables | grep REDIS_URL

# Re-create Redis service if needed
railway add --database redis
```

#### 3. Module Import Errors

**Symptom:** `ModuleNotFoundError: No module named 'arifos'`

**Solutions:**
```bash
# Verify requirements.txt is complete
cat requirements.txt

# Force rebuild
railway up --force

# Check Python version (should be 3.11+)
railway run python --version
```

#### 4. Port Binding Issues

**Symptom:** `Address already in use`

**Solutions:**
```bash
# Verify PORT environment variable
railway variables | grep PORT

# Railway automatically sets PORT - don't override
# Server should bind to 0.0.0.0 and $PORT
```

#### 5. High Latency / Timeouts

**Symptom:** Requests take > 30 seconds

**Solutions:**
```bash
# Check for Redis connection pooling issues
# Increase worker count in Dockerfile CMD
# Use Railway's scaling options (paid plans)

# Monitor metrics
railway logs --tail 100
```

### Debugging Commands

```bash
# View real-time logs
railway logs --tail

# Check service status
railway status

# View environment variables
railway variables

# SSH into container (if enabled)
railway shell

# Restart service
railway restart

# View deployment history
railway deployments
```

### Getting Help

- **Railway Documentation:** [docs.railway.app](https://docs.railway.app)
- **arifOS Issues:** [github.com/ariffazil/arifOS/issues](https://github.com/ariffazil/arifOS/issues)
- **Railway Discord:** [discord.gg/railway](https://discord.gg/railway)

---

## Advanced Configuration

### Custom Domain

```bash
# Add custom domain
railway domain add yourdomain.com

# Railway provides DNS instructions
# Add CNAME record: yourdomain.com → your-app.up.railway.app
```

### Volume Persistence

For persistent storage (VAULT999 data):

```bash
# Add volume (paid plans)
railway volume create /var/data

# Verify volume is mounted
railway shell
ls -la /var/data
```

### Multi-Environment Setup

```bash
# Create staging environment
railway environment create staging

# Switch to staging
railway environment staging

# Deploy to staging
railway up
```

### Monitoring and Alerts

**Built-in Monitoring:**
- Railway dashboard shows CPU, memory, network metrics
- Access via: Project → Metrics tab

**Custom Monitoring:**
- Use `/dashboard` endpoint for live telemetry
- Export metrics to external services (Prometheus, Grafana)

### Scaling

```bash
# Scale horizontally (paid plans)
railway scale 3

# Scale vertically (increase resources)
# Edit in Railway dashboard → Settings → Resources
```

### CI/CD Integration

**GitHub Actions Example:**

```yaml
name: Deploy to Railway

on:
  push:
    branches: [main]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Install Railway CLI
        run: npm install -g @railway/cli
      - name: Deploy
        run: railway up
        env:
          RAILWAY_TOKEN: ${{ secrets.RAILWAY_TOKEN }}
```

---

## Deployment Checklist

### Pre-Deployment

- [ ] Repository cloned/forked
- [ ] `.railway-env` configured (if using)
- [ ] `railway.toml` present
- [ ] `Dockerfile` present
- [ ] Requirements installed locally
- [ ] Pre-commission script runs successfully
- [ ] All tests pass locally

### Deployment

- [ ] Railway project created
- [ ] GitHub integration enabled
- [ ] Redis service added
- [ ] Environment variables configured
- [ ] Domain configured (if using custom domain)
- [ ] Deployment triggered
- [ ] Health check passes

### Post-Deployment

- [ ] Health endpoint returns 200
- [ ] `/checkpoint` endpoint functional
- [ ] Redis connection verified
- [ ] Validation script passes
- [ ] Load test results acceptable
- [ ] Monitoring configured
- [ ] Documentation updated

---

## Success Criteria

After following this guide, you should have:

1. ✅ arifOS deployed to Railway
2. ✅ Health endpoint responding at `/health`
3. ✅ Checkpoint endpoint functional at `/checkpoint`
4. ✅ Redis connection active
5. ✅ All 5 Trinity tools accessible
6. ✅ Monitoring dashboard live at `/dashboard`
7. ✅ Load test showing acceptable performance

---

## Next Steps

- **Integrate with MCP Clients**: See [MCP_CLIENT_INTEGRATION.md](./MCP_CLIENT_INTEGRATION.md)
- **Configure Monitoring**: Set up external monitoring (Sentry, Datadog, etc.)
- **Scale as Needed**: Adjust resources based on usage patterns
- **Review Logs**: Monitor for constitutional violations or errors

---

**DITEMPA BUKAN DIBERI** - Forged, Not Given

**Authority:** Muhammad Arif bin Fazil  
**Version:** arifOS v52.5.1-SEAL  
**Last Updated:** 2026-01-26
