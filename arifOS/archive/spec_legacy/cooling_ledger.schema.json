{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "CoolingLedgerEntry",
  "description": "Schema for arifOS Cooling Ledger entries (v35Ω)",
  "type": "object",
  "properties": {
    "ledger_version": {
      "type": "string",
      "description": "Schema version (v35Ω)",
      "const": "v35Ω"
    },
    "timestamp": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp of the verdict"
    },
    "job_id": {
      "type": "string",
      "description": "Unique identifier for this processing job"
    },
    "parent_hash": {
      "type": ["string", "null"],
      "description": "v38.3 AMENDMENT 1: SHA3-256 hash of parent entry (for branched states like SABAR_EXTENDED). Null for root entries.",
      "pattern": "^[a-f0-9]{64}$"
    },
    "stakes": {
      "type": "string",
      "enum": ["low", "medium", "high", "critical"],
      "description": "Risk level classification"
    },
    "pipeline_path": {
      "type": "array",
      "items": {
        "type": "string",
        "pattern": "^[0-9]{3}_[A-Z]+$"
      },
      "description": "Stages traversed (000_VOID → 999_SEAL)"
    },
    "metrics": {
      "type": "object",
      "description": "All floor metrics at verdict time",
      "properties": {
        "truth": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "F1: Factual integrity (≥0.99 for SEAL)"
        },
        "delta_s": {
          "type": "number",
          "description": "F2: Clarity gain (≥0 for SEAL)"
        },
        "peace_squared": {
          "type": "number",
          "description": "F3: Stability (≥1.0 for SEAL)"
        },
        "kappa_r": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "F4: Empathy conductance (≥0.95 for SEAL)"
        },
        "omega_0": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "F5: Humility band (0.03-0.05 for SEAL)"
        },
        "amanah": {
          "type": "boolean",
          "description": "F6: Integrity lock (true for SEAL)"
        },
        "rasa": {
          "type": "boolean",
          "description": "F7: Felt Care protocol (true for SEAL)"
        },
        "tri_witness": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "F8: Tri-Witness consensus (≥0.95 for high-stakes)"
        },
        "anti_hantu": {
          "type": "string",
          "enum": ["PASS", "FAIL"],
          "description": "F9: Soul-Safe floor (PASS for SEAL)"
        },
        "psi": {
          "type": "number",
          "description": "Computed vitality (≥1.0 for SEAL)"
        },
        "ambiguity": {
          "type": "number",
          "description": "Extended: Linguistic ambiguity (≤0.1)"
        },
        "drift_delta": {
          "type": "number",
          "description": "Extended: Hallucination detection (≥0.1)"
        },
        "paradox_load": {
          "type": "number",
          "description": "Extended: Paradox instability (<1.0)"
        }
      },
      "required": ["truth", "delta_s", "peace_squared", "kappa_r", "omega_0", "amanah", "rasa", "psi"]
    },
    "verdict": {
      "type": "string",
      "enum": ["SEAL", "PARTIAL", "888_HOLD", "VOID", "SABAR", "SABAR_EXTENDED", "SUNSET"],
      "description": "APEX PRIME verdict (v38.3: added SABAR_EXTENDED and SUNSET)"
    },
    "floor_failures": {
      "type": "array",
      "items": {
        "type": "string",
        "enum": ["F1_Truth", "F2_DeltaS", "F3_Peace2", "F4_KappaR", "F5_Omega0", "F6_Amanah", "F7_RASA", "F8_TriWitness", "F9_AntiHantu", "Ambiguity", "DriftDelta", "ParadoxLoad", "Dignity", "VaultConsistency", "BehaviorDrift", "OntologyGuard", "SleeperScan"]
      },
      "description": "List of failed floor names"
    },
    "eye_flags": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "view_id": {
            "type": "integer",
            "minimum": 1,
            "maximum": 10
          },
          "view_name": {
            "type": "string"
          },
          "severity": {
            "type": "string",
            "enum": ["info", "warning", "blocking"]
          },
          "message": {
            "type": "string"
          }
        },
        "required": ["view_id", "view_name", "severity", "message"]
      },
      "description": "@EYE Sentinel flags from 10 views"
    },
    "cce_audits": {
      "type": "object",
      "description": "CCE 4-audit chain (v35Ω required)",
      "properties": {
        "delta_p": {
          "type": "string",
          "enum": ["PASS", "FAIL", "WARN"],
          "description": "Contrast audit (logical coherence, ΔS)"
        },
        "omega_p": {
          "type": "string",
          "enum": ["PASS", "FAIL", "WARN"],
          "description": "Humility audit (κᵣ, tone, Ω₀)"
        },
        "psi_p": {
          "type": "string",
          "enum": ["PASS", "FAIL", "WARN"],
          "description": "Vitality audit (Peace², equilibrium)"
        },
        "phi_p": {
          "type": "string",
          "enum": ["PASS", "FAIL", "WARN"],
          "description": "Ethics audit (Maruah, Amanah)"
        }
      },
      "required": ["delta_p", "omega_p", "psi_p", "phi_p"]
    },
    "tri_witness_components": {
      "type": "object",
      "description": "Tri-Witness breakdown",
      "properties": {
        "human": {
          "type": "number",
          "minimum": 0,
          "maximum": 1
        },
        "ai": {
          "type": "number",
          "minimum": 0,
          "maximum": 1
        },
        "earth": {
          "type": "number",
          "minimum": 0,
          "maximum": 1
        }
      }
    },
    "organs": {
      "type": "object",
      "description": "W@W organ veto flags",
      "properties": {
        "@RIF": { "type": "boolean" },
        "@WELL": { "type": "boolean" },
        "@WEALTH": { "type": "boolean" },
        "@GEOX": { "type": "boolean" },
        "@PROMPT": { "type": "boolean" }
      }
    },
    "context_summary": {
      "type": "string",
      "description": "Brief context/query summary"
    },
    "reason": {
      "type": "string",
      "description": "Human-readable reason for verdict"
    },
    "sabar_reason": {
      "type": ["string", "null"],
      "description": "If SABAR triggered, the specific cause"
    },
    "phoenix_cycle_id": {
      "type": ["string", "null"],
      "description": "If under Phoenix-72 review, the cycle ID"
    },
    "hash_chain": {
      "type": "object",
      "description": "Hash-chaining for integrity (L1)",
      "properties": {
        "previous_hash": {
          "type": "string",
          "description": "Hash of previous entry"
        },
        "current_hash": {
          "type": "string",
          "description": "Hash of this entry"
        },
        "signature": {
          "type": "string",
          "description": "KMS signature (optional)"
        }
      }
    },
    "metadata": {
      "type": "object",
      "description": "Additional metadata",
      "properties": {
        "model": {
          "type": "string",
          "description": "LLM model used"
        },
        "user": {
          "type": "string",
          "description": "User identifier"
        },
        "epoch": {
          "type": "string",
          "description": "arifOS epoch (v35Ω)"
        },
        "runtime_ms": {
          "type": "number",
          "description": "Processing time in milliseconds"
        }
      }
    }
  },
  "required": [
    "ledger_version",
    "timestamp",
    "job_id",
    "metrics",
    "verdict",
    "cce_audits"
  ]
}
